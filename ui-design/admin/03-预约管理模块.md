# 03 - 预约管理模块

> 状态：📋 规划中  
> 优先级：P0（核心功能）

---

## 3.1 预约记录 (Reservation)

### 页面信息

- **页面路径**：`/study/reservation`
- **页面类型**：列表页
- **访问权限**：预约管理权限

### 页面布局

```text
┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│  预约管理 / 预约记录                                                                                                │
├────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                    │
│  ┌─ 搜索条件 ────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │ 用户昵称：┌────────────────┐  手机号：┌────────────────┐  教室：┌────────────────┐  状态：┌────────────────┐ │ │
│  │          │                │         │                │       │ 全部        ▼ │       │ 全部        ▼ │ │ │
│  │          └────────────────┘         └────────────────┘       └────────────────┘       └────────────────┘ │ │
│  │                                                                                                          │ │
│  │ 预约日期：┌──────────────────────────────────┐                            [搜索]  [重置]      [导出]     │ │
│  │          │                                  │                                                            │ │
│  │          └──────────────────────────────────┘                                                            │ │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                    │
│  ┌─ 数据列表 ────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │ 预约编号          │ 用户     │ 教室               │ 座位   │ 预约时段                │ 状态     │ 操作        │ │
│  │───────────────────┼──────────┼────────────────────┼────────┼─────────────────────────┼──────────┼─────────────│ │
│  │ BK20241204001     │ 张三     │ 图书馆-2F-自习室201│ 17号   │ 2024-12-04 14:00-18:00  │ 🟢使用中 │ 详情 强制签退│ │
│  │───────────────────┼──────────┼────────────────────┼────────┼─────────────────────────┼──────────┼─────────────│ │
│  │ BK20241204002     │ 李四     │ 图书馆-3F-自习室301│ 08号   │ 2024-12-04 09:00-12:00  │ ⚪已完成 │ 详情        │ │
│  │───────────────────┼──────────┼────────────────────┼────────┼─────────────────────────┼──────────┼─────────────│ │
│  │ BK20241204003     │ 王五     │ 教学楼A-5F-自习室502│ 12号   │ 2024-12-04 14:00-16:00  │ 🔵待签到 │ 详情 取消   │ │
│  │───────────────────┼──────────┼────────────────────┼────────┼─────────────────────────┼──────────┼─────────────│ │
│  │ BK20241203001     │ 赵六     │ 图书馆-2F-自习室202│ 05号   │ 2024-12-03 19:00-21:00  │ 🔴已违约 │ 详情        │ │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                    │
│                                                                          共 256 条记录   < 1/13 >   每页 20 条     │
│                                                                                                                    │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```


### 预约状态说明

| 状态 | 值 | 颜色 | 说明 |
| ---- | -- | ---- | ---- |
| 待签到 | 0 | 蓝色 | 预约已生效，等待签到 |
| 使用中 | 1 | 绿色 | 已签到，正在使用 |
| 临时离开 | 2 | 橙色 | 暂时离开座位 |
| 已完成 | 3 | 灰色 | 正常完成 |
| 已取消 | 4 | 灰色 | 用户取消 |
| 已违约 | 5 | 红色 | 超时未签到 |

### 预约详情弹窗

```text
┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│  预约详情                                                                                                      ✕   │
├────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                    │
│  预约编号：BK20241204001                                                预约时间：2024-12-04 10:30:25              │
│                                                                                                                    │
│  ┌─ 用户信息 ────────────────────────────────────────────┐  ┌─ 预约信息 ────────────────────────────────────────┐ │
│  │                                                       │  │                                                    │ │
│  │  用户昵称：张三                                        │  │  教室：    图书馆 2F 自习室201                      │ │
│  │  手机号：  138****8888                                │  │  座位：    17号座位                                 │ │
│  │  信用分：  98分                                       │  │  预约日期：2024-12-04                               │ │
│  │                                                       │  │  预约时段：14:00 - 18:00                            │ │
│  │                                                       │  │  状态：    使用中                                   │ │
│  │                                                       │  │                                                    │ │
│  └───────────────────────────────────────────────────────┘  └────────────────────────────────────────────────────┘ │
│                                                                                                                    │
│  ┌─ 签到信息 ────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                                                               │ │
│  │  签到时间：2024-12-04 13:58:32                        签退时间：-                        学习时长：2小时35分钟 │ │
│  │                                                                                                               │ │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                    │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐│
│  │                                                     关闭                                                        ││
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘│
│                                                                                                                    │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 强制签退确认

```text
┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│  强制签退                                                                                                      ✕   │
├────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                    │
│  ⚠️ 确定要强制签退该预约吗？                                                                                        │
│                                                                                                                    │
│  用户：张三                              座位：图书馆 2F 自习室201 17号                    预约时段：14:00 - 18:00  │
│                                                                                                                    │
│  签退原因：                                                                                                        │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐│
│  │ 请输入强制签退原因                                                                                             ││
│  │                                                                                                                ││
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘│
│                                                                                                                    │
│  ☐ 扣除信用分（-5分）                                                                                              │
│                                                                                                                    │
│                                                                                    ┌─────────┐     ┌─────────┐    │
│                                                                                    │  取消   │     │  确定   │    │
│                                                                                    └─────────┘     └─────────┘    │
│                                                                                                                    │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 3.2 签到记录 (CheckIn)

### 页面信息

- **页面路径**：`/study/checkin`
- **页面类型**：列表页

### 页面布局

```text
┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│  预约管理 / 签到记录                                                                                                │
├────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                    │
│  ┌─ 搜索条件 ────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │ 用户昵称：┌────────────────┐  教室：┌────────────────┐  类型：┌────────────────┐                              │ │
│  │          │                │       │ 全部        ▼ │       │ 全部        ▼ │                              │ │
│  │          └────────────────┘       └────────────────┘       └────────────────┘                              │ │
│  │                                                                                                            │ │
│  │ 签到日期：┌──────────────────────────────────┐                              [搜索]  [重置]      [导出]     │ │
│  │          │                                  │                                                              │ │
│  │          └──────────────────────────────────┘                                                              │ │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                    │
│  ┌─ 数据列表 ────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │ 用户     │ 教室                   │ 座位   │ 类型         │ 操作时间              │ 关联预约                  │ │
│  │──────────┼────────────────────────┼────────┼──────────────┼───────────────────────┼───────────────────────────│ │
│  │ 张三     │ 图书馆-2F-自习室201    │ 17号   │ 🟢签到       │ 2024-12-04 13:58:32   │ BK20241204001             │ │
│  │──────────┼────────────────────────┼────────┼──────────────┼───────────────────────┼───────────────────────────│ │
│  │ 李四     │ 图书馆-3F-自习室301    │ 08号   │ 🔵签退       │ 2024-12-04 12:05:18   │ BK20241204002             │ │
│  │──────────┼────────────────────────┼────────┼──────────────┼───────────────────────┼───────────────────────────│ │
│  │ 王五     │ 图书馆-2F-自习室201    │ 05号   │ 🟡临时离开   │ 2024-12-04 11:30:45   │ BK20241204003             │ │
│  │──────────┼────────────────────────┼────────┼──────────────┼───────────────────────┼───────────────────────────│ │
│  │ 王五     │ 图书馆-2F-自习室201    │ 05号   │ 🟢返回座位   │ 2024-12-04 11:45:22   │ BK20241204003             │ │
│  │──────────┼────────────────────────┼────────┼──────────────┼───────────────────────┼───────────────────────────│ │
│  │ 赵六     │ 教学楼A-5F-自习室502   │ 12号   │ 🔴强制签退   │ 2024-12-04 10:30:00   │ BK20241204004             │ │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                    │
│                                                                          共 1024 条记录  < 1/52 >   每页 20 条     │
│                                                                                                                    │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 签到类型

| 类型 | 值 | 说明 |
| ---- | -- | ---- |
| 签到 | 1 | 正常签到 |
| 签退 | 2 | 正常签退 |
| 临时离开 | 3 | 临时离开座位 |
| 返回座位 | 4 | 临时离开后返回 |
| 强制签退 | 5 | 管理员强制签退 |

---

## 3.3 违约记录 (Violation)

### 页面信息

- **页面路径**：`/study/violation`
- **页面类型**：列表页

### 页面布局

```text
┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│  预约管理 / 违约记录                                                                                                │
├────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                    │
│  ┌─ 搜索条件 ────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │ 用户昵称：┌────────────────┐  违约类型：┌────────────────┐  处理状态：┌────────────────┐                      │ │
│  │          │                │           │ 全部        ▼ │           │ 全部        ▼ │                      │ │
│  │          └────────────────┘           └────────────────┘           └────────────────┘                      │ │
│  │                                                                                                            │ │
│  │ 违约日期：┌──────────────────────────────────┐                              [搜索]  [重置]      [导出]     │ │
│  │          │                                  │                                                              │ │
│  │          └──────────────────────────────────┘                                                              │ │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                    │
│  ┌─ 数据列表 ────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │ 用户     │ 违约类型       │ 扣除积分 │ 关联预约          │ 违约时间              │ 状态     │ 操作          │ │
│  │──────────┼────────────────┼──────────┼───────────────────┼───────────────────────┼──────────┼───────────────│ │
│  │ 张三     │ 🔴爽约         │ -10      │ BK20241204001     │ 2024-12-04 14:15:00   │ 🟡待处理 │ 处理          │ │
│  │──────────┼────────────────┼──────────┼───────────────────┼───────────────────────┼──────────┼───────────────│ │
│  │ 李四     │ 🟡迟到签到     │ -5       │ BK20241203002     │ 2024-12-03 14:18:32   │ ⚪已处理 │ 详情          │ │
│  │──────────┼────────────────┼──────────┼───────────────────┼───────────────────────┼──────────┼───────────────│ │
│  │ 王五     │ 🟠临时取消     │ -3       │ BK20241202003     │ 2024-12-02 13:30:15   │ ⚪已处理 │ 详情          │ │
│  │──────────┼────────────────┼──────────┼───────────────────┼───────────────────────┼──────────┼───────────────│ │
│  │ 赵六     │ 🟡临时离开超时 │ -5       │ BK20241201004     │ 2024-12-01 16:45:00   │ ⚪已处理 │ 详情          │ │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                    │
│                                                                          共 128 条记录   < 1/7 >    每页 20 条     │
│                                                                                                                    │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 违约类型

| 类型 | 扣分 | 说明 |
| ---- | ---- | ---- |
| 爽约 | -10 | 未签到自动取消 |
| 迟到签到 | -5 | 超过签到时间15分钟内签到 |
| 临时取消 | -3 | 开始前1小时内取消 |
| 临时离开超时 | -5 | 临时离开超过30分钟 |

### 违约处理弹窗

```text
┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│  违约处理                                                                                                      ✕   │
├────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                    │
│  用户：张三                              违约类型：爽约                              违约时间：2024-12-04 14:15    │
│  预约信息：图书馆 2F 自习室201 17号                                                                                │
│                                                                                                                    │
│  ┌─ 处理方式 ────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                                                               │ │
│  │  ○ 确认违约（扣除10分）              ○ 免除处罚（不扣分）                                                      │ │
│  │                                                                                                               │ │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                    │
│  处理备注：                                                                                                        │
│  ┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐│
│  │                                                                                                                ││
│  │                                                                                                                ││
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘│
│                                                                                                                    │
│                                                                                    ┌─────────┐     ┌─────────┐    │
│                                                                                    │  取消   │     │  确定   │    │
│                                                                                    └─────────┘     └─────────┘    │
│                                                                                                                    │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 3.4 接口依赖

| 接口名称 | 请求方式 | 接口路径 | 说明 |
| -------- | -------- | -------- | ---- |
| 预约记录列表 | GET | `/admin-api/study/reservation/page` | 分页查询预约记录 |
| 预约详情 | GET | `/admin-api/study/reservation/get` | 获取预约详情 |
| 强制签退 | POST | `/admin-api/study/reservation/force-checkout` | 强制签退 |
| 导出预约记录 | GET | `/admin-api/study/reservation/export` | 导出Excel |
| 签到记录列表 | GET | `/admin-api/study/checkin/page` | 分页查询签到记录 |
| 违约记录列表 | GET | `/admin-api/study/violation/page` | 分页查询违约记录 |
| 处理违约 | POST | `/admin-api/study/violation/handle` | 处理违约记录 |

---

> 上一篇：[02-自习室管理模块](./02-自习室管理模块.md)  
> 下一篇：[04-用户管理模块](./04-用户管理模块.md)
