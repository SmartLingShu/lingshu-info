# 07 - 系统设置模块

> 状态：📋 规划中  
> 优先级：P1（重要功能）

---

## 7.1 预约规则配置 (Booking Rules)

### 页面信息

- **页面路径**：`/study/config/booking`
- **页面类型**：配置页
- **访问权限**：系统配置权限

### 页面布局

```text
┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│  系统设置 / 预约规则配置                                                                                            │
├────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                    │
│  ┌─ 基础规则 ────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                                                               │ │
│  │  开放时间段：┌────────────┐  至  ┌────────────┐                                                               │ │
│  │             │  08:00     │      │  22:00     │                                                               │ │
│  │             └────────────┘      └────────────┘                                                               │ │
│  │                                                                                                               │ │
│  │  时段划分（分钟）：┌────────────┐  每30分钟为一个可预约时段                                                    │ │
│  │                   │    30      │                                                                             │ │
│  │                   └────────────┘                                                                             │ │
│  │                                                                                                               │ │
│  │  最短预约时长（分钟）：┌────────────┐  最少预约1小时                                                           │ │
│  │                       │    60      │                                                                         │ │
│  │                       └────────────┘                                                                         │ │
│  │                                                                                                               │ │
│  │  最长预约时长（小时）：┌────────────┐  最多预约4小时                                                           │ │
│  │                       │    4       │                                                                         │ │
│  │                       └────────────┘                                                                         │ │
│  │                                                                                                               │ │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                    │
│  ┌─ 预约限制 ────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                                                               │ │
│  │  提前预约天数：┌────────────┐  最多提前3天预约                                                                 │ │
│  │               │    3       │                                                                                 │ │
│  │               └────────────┘                                                                                 │ │
│  │                                                                                                               │ │
│  │  每日预约次数限制：┌────────────┐  每人每天最多预约2次                                                         │ │
│  │                   │    2       │                                                                             │ │
│  │                   └────────────┘                                                                             │ │
│  │                                                                                                               │ │
│  │  同时进行中预约数：┌────────────┐  同一时间只能有1个进行中的预约                                               │ │
│  │                   │    1       │                                                                             │ │
│  │                   └────────────┘                                                                             │ │
│  │                                                                                                               │ │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                    │
│  ┌─ 签到规则 ────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                                                               │ │
│  │  签到时间窗口（分钟）：提前 ┌────────────┐ 至 延后 ┌────────────┐  预约开始前15分钟至开始后15分钟内可签到      │ │
│  │                           │    15      │        │    15      │                                              │ │
│  │                           └────────────┘        └────────────┘                                              │ │
│  │                                                                                                               │ │
│  │  迟到判定时间（分钟）：┌────────────┐  超过预约开始时间15分钟视为迟到                                          │ │
│  │                       │    15      │                                                                         │ │
│  │                       └────────────┘                                                                         │ │
│  │                                                                                                               │ │
│  │  自动取消时间（分钟）：┌────────────┐  超过30分钟未签到自动取消（爽约）                                        │ │
│  │                       │    30      │                                                                         │ │
│  │                       └────────────┘                                                                         │ │
│  │                                                                                                               │ │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                    │
│  ┌─ 取消规则 ────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                                                               │ │
│  │  免责取消时间（分钟）：┌────────────┐  预约开始前60分钟取消不扣分                                              │ │
│  │                       │    60      │                                                                         │ │
│  │                       └────────────┘                                                                         │ │
│  │                                                                                                               │ │
│  │  ☐ 允许预约开始后取消                                                                                         │ │
│  │                                                                                                               │ │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                    │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐│
│  │                                                  保存配置                                                       ││
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘│
│                                                                                                                    │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 配置项说明

| 配置项 | 类型 | 默认值 | 说明 |
| ------ | ---- | ------ | ---- |
| 开放时间段 | 时间范围 | 08:00-22:00 | 自习室开放时间 |
| 时段划分 | 数字 | 30 | 预约时段最小单位（分钟） |
| 最短预约时长 | 数字 | 60 | 单次预约最短时长（分钟） |
| 最长预约时长 | 数字 | 4 | 单次预约最长时长（小时） |
| 提前预约天数 | 数字 | 3 | 最多提前几天预约 |
| 每日预约次数 | 数字 | 2 | 每人每天最多预约次数 |
| 同时进行中预约数 | 数字 | 1 | 同时进行中的预约数量 |
| 签到提前时间 | 数字 | 15 | 可提前签到的时间（分钟） |
| 签到延后时间 | 数字 | 15 | 可延后签到的时间（分钟） |
| 迟到判定时间 | 数字 | 15 | 超过多久视为迟到（分钟） |
| 自动取消时间 | 数字 | 30 | 未签到自动取消时间（分钟） |
| 免责取消时间 | 数字 | 60 | 提前多久取消不扣分（分钟） |

---

## 7.2 积分规则配置 (Credit Rules)

### 页面信息

- **页面路径**：`/study/config/credit`
- **页面类型**：配置页
- **访问权限**：系统配置权限

### 页面布局

```text
┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│  系统设置 / 积分规则配置                                                                                            │
├────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                    │
│  ┌─ 积分获取规则 ────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                                                               │ │
│  │  按时履约奖励：┌────────────┐  正常完成预约获得积分                                                            │ │
│  │               │   +2       │                                                                                 │ │
│  │               └────────────┘                                                                                 │ │
│  │                                                                                                               │ │
│  │  提前释放奖励：┌────────────┐  提前30分钟以上签退获得积分                                                      │ │
│  │               │   +1       │                                                                                 │ │
│  │               └────────────┘                                                                                 │ │
│  │                                                                                                               │ │
│  │  连续履约奖励：连续 ┌────────────┐ 天按时履约，额外奖励 ┌────────────┐ 分                                      │ │
│  │                    │    7       │                     │   +3       │                                        │ │
│  │                    └────────────┘                     └────────────┘                                        │ │
│  │                                                                                                               │ │
│  │  信用恢复奖励：连续 ┌────────────┐ 次按时履约，恢复 ┌────────────┐ 分                                          │ │
│  │                    │    5       │                 │   +5       │                                            │ │
│  │                    └────────────┘                 └────────────┘                                            │ │
│  │                                                                                                               │ │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                    │
│  ┌─ 积分扣除规则 ────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                                                               │ │
│  │  迟到签到扣分：┌────────────┐  超过签到时间但在15分钟内签到                                                    │ │
│  │               │   -5       │                                                                                 │ │
│  │               └────────────┘                                                                                 │ │
│  │                                                                                                               │ │
│  │  爽约扣分：┌────────────┐  未签到导致预约自动取消                                                              │ │
│  │           │   -10      │                                                                                     │ │
│  │           └────────────┘                                                                                     │ │
│  │                                                                                                               │ │
│  │  临时取消扣分：┌────────────┐  预约开始前1小时内取消                                                           │ │
│  │               │   -3       │                                                                                 │ │
│  │               └────────────┘                                                                                 │ │
│  │                                                                                                               │ │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                    │
│  ┌─ 信用等级配置 ────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                                                               │ │
│  │  等级       │ 分数范围         │ 最长预约         │ 提前预约         │ 特殊权益                                │ │
│  │ ────────────┼──────────────────┼──────────────────┼──────────────────┼─────────────────────────────────────────│ │
│  │  优秀       │ 90-100           │ 4小时            │ 3天              │ 优先选座                                │ │
│  │  良好       │ 80-89            │ 4小时            │ 2天              │ -                                       │ │
│  │  一般       │ 60-79            │ 3小时            │ 1天              │ -                                       │ │
│  │  较差       │ 40-59            │ 2小时            │ 当天             │ -                                       │ │
│  │  限制       │ 0-39             │ 限制预约         │ -                │ -                                       │ │
│  │                                                                                                               │ │
│  │  [编辑等级配置]                                                                                                │ │
│  │                                                                                                               │ │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                    │
│  ┌─ 黑名单规则 ──────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                                                               │ │
│  │  自动加入黑名单条件：                                                                                         │ │
│  │                                                                                                               │ │
│  │  ☑ 连续爽约 ┌────────────┐ 次                                                                                │ │
│  │            │    3       │                                                                                    │ │
│  │            └────────────┘                                                                                    │ │
│  │                                                                                                               │ │
│  │  ☑ 信用分低于 ┌────────────┐ 分                                                                              │ │
│  │              │    20      │                                                                                  │ │
│  │              └────────────┘                                                                                  │ │
│  │                                                                                                               │ │
│  │  默认限制天数：┌────────────┐ 天                                                                              │ │
│  │               │    7       │                                                                                 │ │
│  │               └────────────┘                                                                                 │ │
│  │                                                                                                               │ │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                    │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐│
│  │                                                  保存配置                                                       ││
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘│
│                                                                                                                    │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 积分规则说明

| 规则类型 | 配置项 | 默认值 | 说明 |
| -------- | ------ | ------ | ---- |
| 获取 | 按时履约 | +2 | 正常完成预约 |
| 获取 | 提前释放 | +1 | 提前30分钟以上签退 |
| 获取 | 连续履约 | +3 | 连续7天按时履约额外奖励 |
| 获取 | 信用恢复 | +5 | 连续5次按时履约恢复 |
| 扣除 | 迟到签到 | -5 | 超过签到时间15分钟内 |
| 扣除 | 爽约 | -10 | 未签到自动取消 |
| 扣除 | 临时取消 | -3 | 开始前1小时内取消 |

---

## 7.3 系统参数配置 (System Parameters)

### 页面信息

- **页面路径**：`/study/config/system`
- **页面类型**：配置页
- **访问权限**：系统配置权限

### 页面布局

```text
┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│  系统设置 / 系统参数配置                                                                                            │
├────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                                    │
│  ┌─ 小程序配置 ──────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                                                               │ │
│  │  小程序名称：┌────────────────────────────────────────────────────────────────────────────────────────────┐   │ │
│  │             │ 智习灵枢                                                                                    │   │ │
│  │             └────────────────────────────────────────────────────────────────────────────────────────────┘   │ │
│  │                                                                                                               │ │
│  │  联系电话：┌────────────────────────────────────────────────────────────────────────────────────────────┐     │ │
│  │           │ 400-xxx-xxxx                                                                                │     │ │
│  │           └────────────────────────────────────────────────────────────────────────────────────────────┘     │ │
│  │                                                                                                               │ │
│  │  客服微信：┌────────────────────────────────────────────────────────────────────────────────────────────┐     │ │
│  │           │ zhixilingshu                                                                                │     │ │
│  │           └────────────────────────────────────────────────────────────────────────────────────────────┘     │ │
│  │                                                                                                               │ │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                    │
│  ┌─ 新用户配置 ──────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                                                               │ │
│  │  新用户初始信用分：┌────────────┐                                                                             │ │
│  │                   │   100      │                                                                             │ │
│  │                   └────────────┘                                                                             │ │
│  │                                                                                                               │ │
│  │  ☑ 新用户首次预约引导                                                                                         │ │
│  │                                                                                                               │ │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                    │
│  ┌─ 消息通知配置 ────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                                                               │ │
│  │  ☑ 预约成功通知          ☑ 签到提醒通知（提前15分钟）          ☑ 签退提醒通知（结束前15分钟）                  │ │
│  │  ☑ 预约取消通知          ☑ 违约扣分通知                        ☑ 黑名单通知                                    │ │
│  │                                                                                                               │ │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                    │
│  ┌─ 数据清理配置 ────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                                                               │ │
│  │  预约记录保留天数：┌────────────┐ 天          操作日志保留天数：┌────────────┐ 天                              │ │
│  │                   │   365      │                             │   90       │                                  │ │
│  │                   └────────────┘                             └────────────┘                                  │ │
│  │                                                                                                               │ │
│  │  导出文件保留天数：┌────────────┐ 天                                                                          │ │
│  │                   │   30       │                                                                             │ │
│  │                   └────────────┘                                                                             │ │
│  │                                                                                                               │ │
│  └────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                                                    │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐│
│  │                                                  保存配置                                                       ││
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘│
│                                                                                                                    │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 系统参数说明

| 配置分类 | 配置项 | 默认值 | 说明 |
| -------- | ------ | ------ | ---- |
| 小程序配置 | 小程序名称 | 智习灵枢 | 显示在小程序中的名称 |
| 小程序配置 | 联系电话 | - | 客服联系电话 |
| 小程序配置 | 客服微信 | - | 客服微信号 |
| 新用户配置 | 初始信用分 | 100 | 新注册用户的初始信用分 |
| 新用户配置 | 首次预约引导 | 开启 | 是否显示新手引导 |
| 消息通知 | 预约成功通知 | 开启 | 预约成功后发送通知 |
| 消息通知 | 签到提醒通知 | 开启 | 预约开始前提醒签到 |
| 消息通知 | 签退提醒通知 | 开启 | 预约结束前提醒签退 |
| 消息通知 | 预约取消通知 | 开启 | 预约被取消时通知 |
| 消息通知 | 违约扣分通知 | 开启 | 违约扣分时通知 |
| 消息通知 | 黑名单通知 | 开启 | 加入黑名单时通知 |
| 数据清理 | 预约记录保留 | 365天 | 预约记录保留时长 |
| 数据清理 | 操作日志保留 | 90天 | 操作日志保留时长 |
| 数据清理 | 导出文件保留 | 30天 | 导出文件保留时长 |

---

## 7.4 接口依赖

| 接口名称 | 请求方式 | 接口路径 | 说明 |
| -------- | -------- | -------- | ---- |
| 获取预约规则 | GET | `/admin-api/study/config/booking` | 获取预约规则配置 |
| 保存预约规则 | PUT | `/admin-api/study/config/booking` | 保存预约规则配置 |
| 获取积分规则 | GET | `/admin-api/study/config/credit` | 获取积分规则配置 |
| 保存积分规则 | PUT | `/admin-api/study/config/credit` | 保存积分规则配置 |
| 获取信用等级 | GET | `/admin-api/study/config/credit/level` | 获取信用等级配置 |
| 保存信用等级 | PUT | `/admin-api/study/config/credit/level` | 保存信用等级配置 |
| 获取系统参数 | GET | `/admin-api/study/config/system` | 获取系统参数配置 |
| 保存系统参数 | PUT | `/admin-api/study/config/system` | 保存系统参数配置 |

---

> 上一篇：[06-数据统计模块](./06-数据统计模块.md)
